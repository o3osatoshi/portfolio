# Changesets

This repository uses `@changesets/cli` to version the publishable packages in the monorepo. At the moment only `@o3osatoshi/ui` and `@o3osatoshi/toolkit` are released to npm; apps and other workspaces are ignored via `.changeset/config.json`.

## Local workflow

1. Run `pnpm release:log` after any change that should ship in a package release. The interactive prompt lets you pick the affected packages, choose the semver bump, and writes a markdown file to `.changeset/`.
2. Commit the new `.changeset/*.md` file(s) alongside the code changes and open a pull request. The changeset documents are applied once they land on `main`.
3. When you need to cut a release manually, run `pnpm release:version`. This applies all pending changesets, updates package versions and changelog files, removes the processed `.changeset` entries, and commits with `chore(release): version packages`.
4. Publish the updated packages with `pnpm release` (runs `changeset publish`). Make sure you are authenticated with the npm registry first; the command also creates git tags for the released versions.
5. Push the release commit and tags so the repository history matches the published artifacts. Review the generated `CHANGELOG.md` files before pushing if you want to adjust wording.

## Automation

Pushing to `main` triggers `.github/workflows/release-packages.yml`. The workflow installs dependencies, builds the repo, and runs `changesets/action@v1` with `pnpm release:version` and `pnpm release`. If `NODE_AUTH_TOKEN` (or `NPM_TOKEN`) is configured, publishing happens automatically; otherwise the action opens a release PR for manual review.

## Writing changeset entries

- Keep one file per logical change so related updates ship together.
- Leave the autogenerated filename (e.g. `calm-pandas-sing.md`) unless you regenerate the entry from scratch.
- Always include YAML front matter:
  ```
  ---
  "@o3osatoshi/ui": minor
  "@o3osatoshi/toolkit": patch
  ---
  ```
  - Quote package names and use `major`, `minor`, or `patch` bumps.
  - Only list packages that should publish; private workspaces and the ignored entries (`@repo/application`, `@repo/domain`, `@repo/prisma`, `@repo/eth`, `@repo/functions`, `@repo/storybook`, `@repo/web`) are skipped automatically.
- Write the body in concise markdownâ€”one bullet point in the imperative mood is usually enough:
  ```
  - add motion tokens and expose `useMotionPreset`
  ```
  - Call out breaking changes explicitly and reference PRs/issues when helpful (e.g. `[#123]`).
- Let `pnpm release:version` delete processed files; do not remove them manually.
